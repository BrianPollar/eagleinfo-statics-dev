{
  "version": 3,
  "sources": ["projects/shared-lib/src/lib/components/input/form/base/form-base.ts"],
  "sourcesContent": ["import { Directive, inject, Input, OnInit } from '@angular/core';\nimport {\n  AbstractControl, ControlContainer, ControlValueAccessor, FormControl, FormGroup, ValidationErrors, Validator\n} from '@angular/forms';\nimport { EagleInfoClientError } from '@main-shared-lib';\n\n@Directive()\nexport abstract class FormFieldBase\nimplements ControlValueAccessor, Validator, OnInit {\n  private controlContainer = inject(ControlContainer);\n\n  // @Input({ required: true }) form!: FormGroup;\n  @Input({ required: true }) formControlName!: string;\n  @Input({ required: true }) label!: string;\n  @Input() errorMessage: string = '';\n\n  // --- Common Properties ---\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  protected _value; // Internal value storage\n  disabled = false;\n  onChange: (value) => void = () => {};\n  onTouched: () => void = () => {};\n  onValidatorChange: () => void = () => {};\n\n  parentFormGroup!: FormGroup; // We'll initialize this in ngOnInit\n\n  /** The specific AbstractControl for this component */\n  control!: AbstractControl; // We'll initialize this in ngOnInit\n\n  ngOnInit(): void {\n    if (!this.controlContainer?.control) {\n      throw new EagleInfoClientError(`BaseFormFieldComponent\n        must be used within a FormGroup or FormGroupName directive.`);\n    }\n    // Get the parent form group from the control container\n    this.parentFormGroup = this.controlContainer.control as FormGroup;\n    if (!this.parentFormGroup) {\n      throw new EagleInfoClientError('Could not find parent FormGroup.');\n    }\n    // Get the specific control using the formControlName\n    const control = this.parentFormGroup.get(this.formControlName);\n\n    if (!control) {\n      throw new EagleInfoClientError(`FormControl with name\n        '${this.formControlName}' not found in the parent FormGroup.`);\n    }\n    this.control = control;\n  }\n\n  // --- Methods ---\n  checkControlInvalidOrDirty(): boolean {\n    // Now use the component's 'control' property directly\n    return Boolean(this.control) && this.control.invalid && (this.control.dirty || this.control.touched);\n  }\n\n  checkControlValidOrDirty(): boolean {\n    // Now use the component's 'control' property directly\n    return Boolean(this.control) && this.control.valid && (this.control.dirty || this.control.touched);\n  }\n\n  // --- Common Methods ---\n  /* checkControlInvalidOrDirty(): boolean {\n    // Use touched instead of dirty for better UX (show error on blur even if unchanged)\n    return Boolean(this.control) && this.control.invalid && (this.control.dirty || this.control.touched);\n  } */\n\n  /** Checks if the underlying FormControl has the required validator */\n  get isFormControlRequired(): boolean {\n    const control = this.control;\n\n    if (!control) {\n      return false;\n    }\n    // Check if the validator function exists\n    if (control.validator) {\n      // Create a temporary control to check the validator output\n      const tempControl = new FormControl();\n      const errors = control.validator(tempControl); // Pass a control to check\n\n      // Check if the 'required' key exists in the errors object\n      return errors ? errors.hasOwnProperty('required') : false;\n    }\n\n    return false; // No validator means not required by validator\n  }\n\n  // --- ControlValueAccessor Implementation ---\n  writeValue(value): void {\n    this._value = value;\n    // Optional: You might want to trigger change detection here if needed\n    // Example: this.cdr.markForCheck(); (requires injecting ChangeDetectorRef)\n  }\n\n  registerOnChange(fn): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn): void {\n    this.onTouched = fn;\n  }\n\n  setDisabledState?(isDisabled: boolean): void {\n    this.disabled = isDisabled;\n    // Optional: Trigger change detection if needed\n  }\n\n  // --- Validator Implementation ---\n  validate(control: AbstractControl): ValidationErrors | null {\n    // Basic validation - can be overridden by child components\n    /* const errors: ValidationErrors = {};\n\n    if (this.isFormControlRequired && !control.value) {\n      errors['required'] = true;\n    }\n\n    // Return null if no errors, otherwise the errors object\n    return Object.keys(errors).length ? errors : null; */\n    return null;\n  }\n\n  registerOnValidatorChange?(fn: () => void): void {\n    this.onValidatorChange = fn;\n  }\n\n  // Helper to update value and notify Angular Forms\n  updateValue(newValue): void {\n    if (newValue !== this._value) {\n      this._value = newValue;\n      this.onChange(newValue);\n      this.onTouched(); // Mark as touched when value changes\n      this.onValidatorChange(); // Notify that validation status might have changed\n    }\n  }\n\n  // Helper for blur event\n  handleBlur(): void {\n    this.onTouched();\n    this.onValidatorChange(); // Re-validate on blur if needed\n  }\n\n  isString(val) {\n    return typeof val === 'string';\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;AAOM,IAAgB,gBAAhB,MAAgB,eAAa;EADnC,cAAA;AAGU,SAAA,mBAAmB,OAAO,gBAAgB;AAKzC,SAAA,eAAuB;AAKhC,SAAA,WAAW;AACX,SAAA,WAA4B,MAAK;IAAE;AACnC,SAAA,YAAwB,MAAK;IAAE;AAC/B,SAAA,oBAAgC,MAAK;IAAE;;EAOvC,WAAQ;AACN,QAAI,CAAC,KAAK,kBAAkB,SAAS;AACnC,YAAM,IAAI,qBAAqB;oEAC+B;IAChE;AAEA,SAAK,kBAAkB,KAAK,iBAAiB;AAC7C,QAAI,CAAC,KAAK,iBAAiB;AACzB,YAAM,IAAI,qBAAqB,kCAAkC;IACnE;AAEA,UAAM,UAAU,KAAK,gBAAgB,IAAI,KAAK,eAAe;AAE7D,QAAI,CAAC,SAAS;AACZ,YAAM,IAAI,qBAAqB;WAC1B,KAAK,eAAe,sCAAsC;IACjE;AACA,SAAK,UAAU;EACjB;;EAGA,6BAA0B;AAExB,WAAO,QAAQ,KAAK,OAAO,KAAK,KAAK,QAAQ,YAAY,KAAK,QAAQ,SAAS,KAAK,QAAQ;EAC9F;EAEA,2BAAwB;AAEtB,WAAO,QAAQ,KAAK,OAAO,KAAK,KAAK,QAAQ,UAAU,KAAK,QAAQ,SAAS,KAAK,QAAQ;EAC5F;;;;;;;EASA,IAAI,wBAAqB;AACvB,UAAM,UAAU,KAAK;AAErB,QAAI,CAAC,SAAS;AACZ,aAAO;IACT;AAEA,QAAI,QAAQ,WAAW;AAErB,YAAM,cAAc,IAAI,YAAW;AACnC,YAAM,SAAS,QAAQ,UAAU,WAAW;AAG5C,aAAO,SAAS,OAAO,eAAe,UAAU,IAAI;IACtD;AAEA,WAAO;EACT;;EAGA,WAAW,OAAK;AACd,SAAK,SAAS;EAGhB;EAEA,iBAAiB,IAAE;AACjB,SAAK,WAAW;EAClB;EAEA,kBAAkB,IAAE;AAClB,SAAK,YAAY;EACnB;EAEA,iBAAkB,YAAmB;AACnC,SAAK,WAAW;EAElB;;EAGA,SAAS,SAAwB;AAU/B,WAAO;EACT;EAEA,0BAA2B,IAAc;AACvC,SAAK,oBAAoB;EAC3B;;EAGA,YAAY,UAAQ;AAClB,QAAI,aAAa,KAAK,QAAQ;AAC5B,WAAK,SAAS;AACd,WAAK,SAAS,QAAQ;AACtB,WAAK,UAAS;AACd,WAAK,kBAAiB;IACxB;EACF;;EAGA,aAAU;AACR,SAAK,UAAS;AACd,SAAK,kBAAiB;EACxB;EAEA,SAAS,KAAG;AACV,WAAO,OAAO,QAAQ;EACxB;;;uBAvIoB,gBAAa;IAAA;EAAA;;yEAAb,gBAAa,QAAA,EAAA,iBAAA,mBAAA,OAAA,SAAA,cAAA,eAAA,EAAA,CAAA;EAAA;;",
  "names": []
}
