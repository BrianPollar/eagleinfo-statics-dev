{
  "version": 3,
  "sources": ["projects/shared-lib/src/lib/defines/composition/view-one.ts"],
  "sourcesContent": ["import { ActivatedRoute, Router } from '@angular/router';\nimport { DatabaseAuto, FrontendLogger, IdeleteOneResponse } from '@biz-nest/core-client';\nimport { EventbusService } from '@front-shared-lib';\nimport { EagleInfoClientError, navByBus, runSubscriptionsForSharedUse } from '@main-shared-lib';\n\ninterface IoneCompose\nextends DatabaseAuto {\n  _id: string;\n  remove?: () => Promise<IdeleteOneResponse | null>;\n}\n\ninterface IstaticOneCompose<T> {\n  getOne: (resourceId: string) => Promise<T>\n}\n\nexport class ViewOneCompose<T extends IoneCompose> {\n  id: string;\n  cleanup?: () => void;\n  oneItem?: T;\n\n  navigateByBus = navByBus(this.eventbus, this.router).navigateByBus;\n\n\n  constructor(\n    private staticCaller: IstaticOneCompose<T>,\n    private updateNavProps: {\n      route: [string],\n      eventName: string\n    },\n    private router: Router,\n    private route: ActivatedRoute,\n    private eventbus: EventbusService\n  ) {\n    this.id = this.route.snapshot?.params['id'];\n\n    if (!this.updateNavProps?.eventName) {\n      FrontendLogger.warn('must provide eventName');\n    }\n  }\n\n  async init() {\n    const handlers = {\n      oneItem: (data: T) => {\n        if (data._id) {\n          this.oneItem = data;\n        }\n\n        // clear bus\n        this.eventbus.generalEvent$.next({ type: 'clear', data: true });\n      }\n    };\n\n    const { cleanup } = runSubscriptionsForSharedUse(this.eventbus, handlers);\n\n    this.cleanup = cleanup;\n\n    this.id = this.route.snapshot?.params['id'];\n\n    FrontendLogger.debug('_ID IS', this.id);\n\n    if (!this.oneItem) {\n      await this.getOne();\n    }\n  }\n\n  async getOne() {\n    try {\n      const one = await this.staticCaller.getOne(this.id);\n\n      this.oneItem = one;\n    } catch (error) {\n      FrontendLogger.error(error);\n    }\n  }\n\n  update() {\n    if (!this.updateNavProps?.route || !this.updateNavProps?.eventName) {\n      throw new EagleInfoClientError('invalid update nav props');\n    }\n    this.navigateByBus(this.updateNavProps?.route, this.updateNavProps?.eventName, this.oneItem);\n  }\n\n  async delete() {\n    try {\n      await this.oneItem?.remove?.();\n    } catch (error) {\n      FrontendLogger.error(error);\n    }\n  }\n\n  printDocument() {\n    window.print();\n  }\n\n  destroy() {\n    this.cleanup?.();\n  }\n}\n\n"],
  "mappings": ";;;;;;;;;;;AAeM,IAAO,iBAAP,MAAqB;EAQzB,YACU,cACA,gBAIA,QACA,OACA,UAAyB;AAPzB,SAAA,eAAA;AACA,SAAA,iBAAA;AAIA,SAAA,SAAA;AACA,SAAA,QAAA;AACA,SAAA,WAAA;AAXV,SAAA,gBAAgB,SAAS,KAAK,UAAU,KAAK,MAAM,EAAE;AAanD,SAAK,KAAK,KAAK,MAAM,UAAU,OAAO,IAAI;AAE1C,QAAI,CAAC,KAAK,gBAAgB,WAAW;AACnC,qBAAe,KAAK,wBAAwB;IAC9C;EACF;EAEM,OAAI;;AACR,YAAM,WAAW;QACf,SAAS,CAAC,SAAW;AACnB,cAAI,KAAK,KAAK;AACZ,iBAAK,UAAU;UACjB;AAGA,eAAK,SAAS,cAAc,KAAK,EAAE,MAAM,SAAS,MAAM,KAAI,CAAE;QAChE;;AAGF,YAAM,EAAE,QAAO,IAAK,6BAA6B,KAAK,UAAU,QAAQ;AAExE,WAAK,UAAU;AAEf,WAAK,KAAK,KAAK,MAAM,UAAU,OAAO,IAAI;AAE1C,qBAAe,MAAM,UAAU,KAAK,EAAE;AAEtC,UAAI,CAAC,KAAK,SAAS;AACjB,cAAM,KAAK,OAAM;MACnB;IACF;;EAEM,SAAM;;AACV,UAAI;AACF,cAAM,MAAM,MAAM,KAAK,aAAa,OAAO,KAAK,EAAE;AAElD,aAAK,UAAU;MACjB,SAAS,OAAO;AACd,uBAAe,MAAM,KAAK;MAC5B;IACF;;EAEA,SAAM;AACJ,QAAI,CAAC,KAAK,gBAAgB,SAAS,CAAC,KAAK,gBAAgB,WAAW;AAClE,YAAM,IAAI,qBAAqB,0BAA0B;IAC3D;AACA,SAAK,cAAc,KAAK,gBAAgB,OAAO,KAAK,gBAAgB,WAAW,KAAK,OAAO;EAC7F;EAEM,SAAM;;AACV,UAAI;AACF,cAAM,KAAK,SAAS,SAAQ;MAC9B,SAAS,OAAO;AACd,uBAAe,MAAM,KAAK;MAC5B;IACF;;EAEA,gBAAa;AACX,WAAO,MAAK;EACd;EAEA,UAAO;AACL,SAAK,UAAS;EAChB;;",
  "names": []
}
