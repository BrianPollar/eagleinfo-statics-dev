{
  "version": 3,
  "sources": ["projects/admin-panel/src/app/components/pane/subscriptions/add-subscription/add-update-subscription.component.ts"],
  "sourcesContent": ["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { Meta, Title } from '@angular/platform-browser';\n// import { SubscriptionPackange } from '@biz-nest/auth-client';\nimport {\n  IcompanySubscription, Ifile, IsubscriptionFeature\n} from '@biz-nest/core-client';\nimport {\n  AppNameService, EventbusService,\n  MainBarTitleService, patternWithMessage, subscriptionDurations\n} from '@front-shared-lib';\nimport { controlNames, runSubscriptionsForSharedUse } from '@main-shared-lib';\n\n@Component({\n  selector: 'app-add-update-subscription',\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  templateUrl: './add-update-subscription.component.html',\n  styleUrl: './add-update-subscription.component.scss'\n})\nexport class AddUpdateSubscriptionComponent\nimplements OnInit, OnDestroy {\n  url = 'subscription';\n  addSubscriptionForm: FormGroup<{\n    [K in keyof Partial<IcompanySubscription>]\n  }>;\n\n  loading = false;\n  subscription;\n  files: Ifile[] = [];\n  posting = false;\n  cleanup?: () => void;\n  errMsg?: string;\n  dateLeft?: Date;\n  features: IsubscriptionFeature[] = [];\n  showModal = false;\n  modalTitle?: string;\n  currFeature?: IsubscriptionFeature;\n  addFeatureForm?: FormGroup<{\n    [K in keyof Partial<IsubscriptionFeature>]\n  }>;\n\n  mainError?: string;\n  durations = subscriptionDurations;\n\n  constructor(\n    private fb: FormBuilder,\n    public eventbus: EventbusService,\n    private apNme: AppNameService,\n    public mainBarTitle: MainBarTitleService,\n    private metaTagService: Meta,\n    private titleService: Title\n  ) {\n    this.addSubscriptionForm = this.fb.group<{\n      [K in keyof Partial<IcompanySubscription>]\n    }>({\n      name: ['', Validators.compose([\n        patternWithMessage(/[a-zA-Z ]*/, 'Only letters are allowed'),\n        Validators.minLength(5),\n        Validators.maxLength(40),\n        Validators.required])],\n      amount: ['', Validators.compose([\n        patternWithMessage(/^[0-9]+$/, 'Only numbers are allowed'),\n        Validators.minLength(3),\n        Validators.maxLength(11),\n        Validators.required])],\n      duration: ['', Validators.compose([\n        Validators.required])],\n      active: ['']\n    });\n  }\n\n  get controlNames() {\n    return controlNames(this.addSubscriptionForm.controls);\n  }\n\n  ngOnInit(): void {\n    const handlers = {\n      updateSubscription: (data) => {\n        this.subscription = data;\n        this.addSubscriptionForm.patchValue(this.subscription);\n      }\n    };\n\n    const { cleanup } = runSubscriptionsForSharedUse(this.eventbus, handlers);\n\n    this.mainBarTitle.title = 'Edit Subscription - ' + (this.subscription?.name || '');\n    this.cleanup = cleanup;\n    this.titleService.setTitle(this.mainBarTitle.title + ' - ' + this.apNme.name);\n    this.metaTagService.updateTag({\n      name: 'description',\n      content: 'Easily manage and edit your subscription plans for optimal service customization.'\n    });\n    if (this.subscription) {\n      this.features = this.subscription.features;\n    }\n  }\n\n  checkControlInvalidOrDirty(controlName: keyof Partial<IcompanySubscription>) {\n    return !this.addSubscriptionForm.get(controlName)?.valid &&\n    this.addSubscriptionForm.get(controlName)?.dirty;\n  }\n\n  fromDateNotif(ev: Date) {\n    this.addSubscriptionForm.controls['startDate'].setValue(ev);\n  }\n\n  toDateNotif(ev: Date) {\n    this.addSubscriptionForm.controls['endDate'].setValue(ev);\n  }\n\n  async addSubscription() {\n    /* if (this.addSubscriptionForm.invalid) {\n      markFormGroupTouched(this.addSubscriptionForm, this);\n      return;\n    } else {\n      if (this.features.length < 3) {\n        this.mainError = 'a minimum of 3 features required, add the to continue';\n        return;\n      }\n      this.posting = true;\n      const data = {\n            _id: this.subscription?._id,\n        name: this.addSubscriptionForm.value.name,\n        amount: this.addSubscriptionForm.value.amount,\n        duration: this.addSubscriptionForm.value.duration,\n        active: Boolean(this.addSubscriptionForm.value.active),\n        features: this.features\n          } as IsubscriptionPackage & { _id?: string};\n      let response: Isuccess;\n      if (this.subscription) {\n        data._id = this.subscription._id;\n        response = await this.subscription\n          .updateSubscriptionPackage(data)\n          .catch((err: AxiosError<Isuccess>) => {\n            FrontendLogger.error('AddSubscriptionComponent:addSubscription:: - err', err);\n            return { success: false, err: err.response?.data?.err };\n            this.posting = false;\n          });\n      } else {\n        response = await SubscriptionPackange.addSubscriptionPackage(data)\n          .catch((err: AxiosError<Isuccess>) => {\n            FrontendLogger.error('AddSubscriptionComponent:addSubscription:: - err', err);\n            return { success: false, err: err.response?.data?.err };\n          });\n        this.posting = false;\n        if (response.success &&\n           this.aataService.stateDataUserSelect &&\n           this.aataService.stateDataUserSelect.exras.backRoute) {\n          this.router.navigate(['/subscription']);\n        }\n      }\n      this.posting = false;\n      if (response?.success) {\n        this.addSubscriptionForm.reset();\n        this.router.navigate(['/subscription']);\n        this.toastr.success('Operation sucessfull...!', 'Success');\n      } else {\n        this.toastr.success('Operation not sucessfull...! ' + (response.err || ''), 'Failed');\n      }\n    } */\n  }\n\n  constructFeatureForm(feature?: IsubscriptionFeature) {\n    this.addFeatureForm = this.fb.group<{\n      [K in keyof Partial<IsubscriptionFeature>]\n    }>({\n      type: [feature?.type || '', Validators.compose([\n        Validators.required])],\n      name: [feature?.name || '', Validators.compose([\n        patternWithMessage(/[a-zA-Z ]*/, 'Only letters are allowed'),\n        Validators.minLength(3),\n        Validators.maxLength(30),\n        Validators.required])],\n      limitSize: [feature?.limitSize || '', Validators.compose([\n        patternWithMessage(/^[0-9]+$/, 'Only numbers(integers) are allowed'),\n        Validators.minLength(3),\n        Validators.maxLength(3000),\n        Validators.required])]\n    });\n  }\n\n\n  addFeature() {\n    this.currFeature = undefined;\n    this.modalTitle = 'Add Feature';\n    this.showModal = true;\n    this.constructFeatureForm();\n  }\n\n  relegateFeatureAdd() {\n    const data = {\n      type: this.addFeatureForm?.value.type,\n      name: this.addFeatureForm?.value.name,\n      description: '',\n      limitSize: Number(this.addFeatureForm?.value.limitSize),\n      remainingSize: Number(this.currFeature?.remainingSize || this.addFeatureForm?.value.limitSize)\n    };\n\n    if (this.currFeature) {\n      this.onUpdateFeature(data);\n    } else {\n      this.onAddFeature(data);\n    }\n  }\n\n  onAddFeature(ev: IsubscriptionFeature) {\n    this.addFeatureForm?.reset();\n    const found = this.features.find((feature) => feature.type === ev.type);\n\n    if (found) {\n      return;\n    }\n    this.features.push(ev);\n  }\n\n  updateFeature(feature: IsubscriptionFeature) {\n    this.showModal = true;\n    this.currFeature = feature;\n    this.constructFeatureForm(feature);\n  }\n\n  onUpdateFeature(feature: IsubscriptionFeature) {\n    const foundIndex = this.features.findIndex(val => val.name === this.currFeature?.name);\n\n    if (typeof foundIndex === 'number') {\n      this.features[foundIndex] = feature;\n    }\n    this.currFeature = undefined;\n  }\n\n  removeFeature(name: string) {\n    const foundIndex = this.features.findIndex(val => val.name === name);\n\n    this.features.splice(foundIndex, 1);\n  }\n\n  ngOnDestroy() {\n    this.cleanup?.();\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
