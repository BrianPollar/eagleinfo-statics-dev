{
  "version": 3,
  "sources": ["projects/shared-lib/src/lib/services/search-suggestions.service.ts", "projects/admin-panel/src/app/components/pane/misc/admin-search-field/admin-search-field.component.ts", "projects/admin-panel/src/app/components/pane/misc/admin-search-field/admin-search-field.component.html"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\nimport { getSearchHistory } from '@biz-nest/commerce-client';\nimport { WebStorageService } from '@front-shared-lib';\nimport { BehaviorSubject, debounceTime, Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchSuggestionsService {\n  private suggestions$$ = new BehaviorSubject<string[]>([]);\n  public suggestions$ = this.suggestions$$.asObservable();\n  private debounceSubject$$?: Subject<{ term: string; component: string }>;\n\n  constructor(private storage: WebStorageService) {}\n\n  // Method to get a user's recent search terms from local storage\n  private getLocalSearchHistory(component: string): string[] {\n    const history = this.storage.get(`${component}_search`);\n\n    return history?.split(',') || [];\n  }\n\n  async fetchSuggestionsFromBackend(term: string): Promise<string[]> {\n    const hist = await getSearchHistory(term);\n\n    return hist;\n  }\n\n  private saveSearchHistory(component: string, term: string) {\n    const history = this.getLocalSearchHistory(component);\n\n    history.push(term);\n    this.storage.set(`${component}_search`, history.join(','));\n  }\n\n  onSearch(term: string, component: string) {\n    this.cancel();\n\n    this.debounceSubject$$ = new Subject<{ term: string; component: string }>();\n    this.debounceSubject$$.pipe(debounceTime(700)).subscribe(({ term, component }) => {\n      this.makeSuggestions(term, component);\n    });\n\n    this.debounceSubject$$.next({ term, component });\n  }\n\n  cancel() {\n    this.debounceSubject$$?.complete();\n  }\n\n\n  // Method called by a component's input event\n  private async makeSuggestions(term: string, component: string) {\n    // 1. Immediately emit local suggestions to the stream\n    const localSuggestions = this.getLocalSearchHistory(component).filter(t => t.includes(term));\n\n    this.suggestions$$.next(localSuggestions);\n\n    // 2. Fetch suggestions from backend\n    const backendSuggestions = await this.fetchSuggestionsFromBackend(term);\n\n    // 3. Remove duplicates and emit combined suggestions\n    const uniqueSuggestions = [...new Set([...localSuggestions, ...backendSuggestions])];\n\n    this.suggestions$$.next(uniqueSuggestions);\n\n    this.saveSearchHistory(component, term);\n  }\n}\n", "import { Component, EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport {\n  FormControl,\n  FormsModule, ReactiveFormsModule\n} from '@angular/forms';\nimport { TooltipComponent } from '@front-shared-lib';\nimport { EagleInfoClientError } from '@main-shared-lib';\nimport { debounceTime, distinctUntilChanged } from 'rxjs';\nimport { SearchSuggestionsService } from '../../../../../../../shared-lib/src/lib/services/search-suggestions.service';\n\nexport interface IsearchSelectOptions {\n  label: string;\n  value: string;\n  isNumber?: boolean;\n}\nexport interface IsearchTerm {\n  [x: string]: string;\n}\n@Component({\n  selector: 'app-admin-search-field',\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    TooltipComponent\n  ],\n  templateUrl: './admin-search-field.component.html',\n  styleUrl: './admin-search-field.component.scss'\n})\nexport class AdminSearchFieldComponent\nimplements OnInit, OnDestroy {\n  @Input() placeholder = 'filter...';\n  @Input({ required: true }) options: IsearchSelectOptions[] = [];\n  localControl: FormControl;\n  optionsControl: FormControl;\n  @Output() filter: EventEmitter<IsearchTerm> = new EventEmitter<IsearchTerm>();\n  suggestions: string[] = [];\n\n  constructor(private searchSuggestionsService: SearchSuggestionsService) {\n    this.localControl = new FormControl();\n    this.optionsControl = new FormControl();\n  }\n\n  ngOnInit(): void {\n    if (!this.filter.observers.length) {\n      throw new EagleInfoClientError('The \"filter\" event must be handled by the parent component.');\n    }\n\n    this.searchSuggestionsService.suggestions$.subscribe((suggestions) => {\n      this.suggestions = suggestions;\n    });\n\n    this.optionsControl.setValue(this.options[0].value);\n\n    this.localControl.valueChanges\n      .pipe(\n        debounceTime(700),\n        distinctUntilChanged()\n      ).subscribe((val) => {\n        const optionsControlVal = this.optionsControl.value;\n\n        this.searchSuggestionsService.onSearch(val, optionsControlVal);\n\n        this.filter.emit({ [optionsControlVal || '_id']: val });\n      });\n\n    this.optionsControl.valueChanges\n      .pipe(\n        debounceTime(700),\n        distinctUntilChanged()\n      ).subscribe((val) => {\n        const localControlVal = this.localControl?.value?.trim();\n\n        if (localControlVal) {\n          this.filter.emit({ [val]: localControlVal });\n        }\n      });\n  }\n\n  suggestionSelected(suggestion: string): void {\n    // change form val and prvent changes trigger\n    this.localControl.setValue(suggestion, { emitEvent: false });\n    this.filter.emit({ type: 'enterPressed', value: suggestion });\n  }\n\n  ngOnDestroy(): void {\n    this.searchSuggestionsService.cancel();\n  }\n}\n", "<form class=\"hidden app-search xl:block\">\n  <div class=\"relative inline-block !rounded-lg flex\">\n    <lib-tooltip [popper]=\"'Search Here'\">\n      <input\n        type=\"text\"\n        class=\"flex-1 !rounded-tl-lg !rounded-bl-lg pl-4 pr-[40px] border-1 !border-r-0 !border-default-dark-shade !bg-default-white focus:ring-0 text-13 placeholder:text-13 max-w-[223px]\"\n        [placeholder]=\"placeholder\"\n        [formControl]=\"localControl\"\n      />\n    </lib-tooltip>\n\n    <div class=\"ltr:ml-auto rtl:mr-auto flex-none\">\n      <lib-tooltip [popper]=\"'Select a field to perform your search.'\">\n        <select\n          class=\"w-[70px] py-0 form-select form-select-sm ltr:pl-4 rtl:pr-4 !border-l-0 !border-default-dark-shade !rounded-[0px] !rounded-tr-lg !rounded-br-lg !bg-default-white-shade h-full\"\n          [formControl]=\"optionsControl\"\n          [value]=\"'Filter By'\"\n        >\n          <option value=\"Filter By\" selected>Filter By</option>\n          @for(option of options; track option.label){\n          <option [value]=\"option.value\">\n            {{ option.label }}\n          </option>\n          }\n        </select>\n      </lib-tooltip>\n    </div>\n  </div>\n</form>\n\n<div class=\"suggestions\">\n  @for(suggestion of suggestions; track $index){\n  <div class=\"suggestion\" (click)=\"suggestionSelected(suggestion)\">\n    {{ suggestion }}\n  </div>\n  }\n</div>\n"],
  "mappings": "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",
  "names": ["term", "component"]
}
