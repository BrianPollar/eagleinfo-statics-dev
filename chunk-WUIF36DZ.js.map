{
  "version": 3,
  "sources": ["projects/shared-lib/src/lib/components/profile/super-permissions/super-permissions.component.ts", "projects/shared-lib/src/lib/components/profile/super-permissions/super-permissions.component.html"],
  "sourcesContent": ["import { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { getUserPermissions, updateUserPermissions, User } from '@biz-nest/auth-client';\nimport { FrontendLogger, Iuser } from '@biz-nest/core-client';\nimport {\n  EagleInfoClientError, Imanager,\n  runSubscriptionsForSharedUse\n} from '@main-shared-lib';\nimport { ToastrService } from 'ngx-toastr';\nimport { DataService } from '../../../services/data.service';\nimport { EventbusService } from '../../../services/eventbus.service';\nimport { TooltipService } from '../../../services/tooltip.service';\nimport { SharedToggleFieldComponent } from '../../input/form/shared-toggle-field/shared-toggle-field.component';\nimport { TooltipComponent } from '../../tooltip/tooltip.component';\nimport { distinctUntilChanged, debounceTime } from 'rxjs';\n\n@Component({\n  selector: 'lib-super-permissions',\n  standalone: true,\n  imports: [\n    RouterModule,\n    FormsModule,\n    ReactiveFormsModule,\n    TooltipComponent,\n    SharedToggleFieldComponent\n  ],\n  templateUrl: './super-permissions.component.html',\n  styleUrl: './super-permissions.component.scss'\n})\nexport class SuperPermissionsComponent\nimplements OnInit, OnDestroy {\n  @Input({ required: true }) manager!: Imanager | User | Iuser;\n  @Input() saveButton = true;\n\n  updatingPerms = false;\n  tooltip = [{\n    accessor: 'orders',\n    content: 'This permission allows the user to view and manage orders.'\n  },\n  {\n    accessor: 'items',\n    content: 'This permission allows the user to view and manage items.'\n  },\n  {\n    accessor: 'companies',\n    content: 'This permission allows the user to view and manage companies.'\n  },\n  {\n    accessor: 'faqs',\n    content: 'This permission allows the user to view and manage faqs.'\n  },\n  {\n    accessor: 'users',\n    content: 'This permission allows the user to view and manage users.'\n  }\n  ];\n\n  permissions: any = {\n    order: false,\n    item: false,\n    company: false,\n    faq: false\n  };\n\n  cleanup?: () => void;\n\n  form: FormGroup;\n\n  constructor(\n    private fb: FormBuilder,\n    public dataService: DataService,\n    public tooltipService: TooltipService,\n    private eventbus: EventbusService,\n    private toastr: ToastrService\n  ) {\n    this.form = this.fb.group({\n      order: [false],\n      item: [false],\n      company: [false],\n      faq: [false]\n    });\n  }\n\n  getTooltipContent(accessor: string) {\n    return this.tooltip.find((t) => t.accessor === accessor)?.content || '';\n  }\n\n  ngOnInit(): void {\n    this.getPermissions();\n    const handlers = {\n      resetPerms: () => {\n        this.permissions = {};\n      }\n    };\n\n    const { cleanup } = runSubscriptionsForSharedUse(this.eventbus, handlers);\n\n    this.cleanup = cleanup;\n    this.listToFormChanges();\n  }\n\n  listToFormChanges() {\n    this.form.valueChanges.pipe(\n      distinctUntilChanged((prev, curr) => JSON.stringify(prev) === JSON.stringify(curr)),\n      debounceTime(3000)\n    ).subscribe(() => {\n      this.savePerms();\n    });\n  }\n\n  async getPermissions() {\n    if (!this.manager) {\n      throw new EagleInfoClientError('no user');\n    }\n\n    let userId = '';\n\n    if ((this.manager as Imanager).authUser) {\n      userId = (this.manager as Imanager).authUser.toString();\n    } else {\n      userId = this.manager._id; // TODO user must be auth user so this can not run\n    }\n\n    if (typeof userId !== 'string') {\n      throw new EagleInfoClientError('no user id');\n    }\n\n    try {\n      const userPerm = await getUserPermissions(userId);\n\n      this.permissions = userPerm.superAdminPermissions;\n      this.form.patchValue(this.permissions);\n    } catch (error) {\n      FrontendLogger.error(error);\n    }\n  }\n\n  async savePerms() {\n    if (this.updatingPerms || !this.manager) {\n      return;\n    }\n\n    let userId = '';\n\n    if ((this.manager as Imanager).authUser) {\n      userId = (this.manager as Imanager).authUser.toString();\n    } else {\n      userId = this.manager._id;\n    }\n\n    if (typeof userId !== 'string') {\n      throw new EagleInfoClientError('no user id');\n    }\n\n    try {\n      this.updatingPerms = true;\n      await updateUserPermissions(userId, { superAdminPermissions: this.form.value });\n\n      this.toastr.success('Permissions updated successfully');\n    } catch (error) {\n      FrontendLogger.error(error);\n\n      this.toastr.error('Failed to update permissions');\n\n      // restore default\n      this.form.patchValue(this.permissions, { emitEvent: false });\n    } finally {\n      this.updatingPerms = false;\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.cleanup?.();\n  }\n}\n\n", "<div class=\"\">\n  <div class=\"text-left\">\n    <div class=\"checkBoxes\">\n      <form [formGroup]=\"form\">\n        <div>\n          <div class=\"pt-2 flex flex-row flex-nowrap\">\n            <lib-tooltip\n              [popper]=\"getTooltipContent('orders')\"\n              [popperShowOnStart]=\"false\"\n            >\n              <lib-shared-toggle-field\n                formControlName=\"orders\"\n                label=\"Orders\"\n              />\n\n              <span class=\"text-secondary\"\n                >*(Allows EcommerceOrder Access)</span\n              >\n              >\n            </lib-tooltip>\n          </div>\n\n          <div class=\"pt-2 flex flex-row flex-nowrap\">\n            <lib-tooltip\n              [popper]=\"getTooltipContent('items')\"\n              [popperShowOnStart]=\"false\"\n            >\n              <lib-shared-toggle-field formControlName=\"items\" label=\"Items\" />\n\n              <span class=\"text-secondary\">*(Allows Item Access)</span>\n            </lib-tooltip>\n          </div>\n\n          <div class=\"pt-2 flex flex-row flex-nowrap\">\n            <lib-shared-toggle-field\n              formControlName=\"companies\"\n              label=\"Companies\"\n            />\n            <lib-tooltip\n              [popper]=\"getTooltipContent('companies')\"\n              [popperShowOnStart]=\"false\"\n            >\n              <lib-shared-toggle-field\n                formControlName=\"companies\"\n                label=\"Companies\"\n              />\n\n              <span class=\"text-secondary\">*(Allows Company Access)</span>\n            </lib-tooltip>\n          </div>\n\n          <div class=\"pt-2 pb-2 flex flex-row flex-nowrap\">\n            <lib-tooltip\n              [popper]=\"getTooltipContent('faqs')\"\n              [popperShowOnStart]=\"false\"\n            >\n              <lib-shared-toggle-field formControlName=\"faqs\" label=\"Faqs\" />\n\n              <span class=\"text-secondary\">*(Allows Faq Management)</span>\n            </lib-tooltip>\n          </div>\n\n          <div class=\"pt-2 pb-2 flex flex-row flex-nowrap\">\n            <lib-tooltip\n              [popper]=\"getTooltipContent('users')\"\n              [popperShowOnStart]=\"false\"\n            >\n              <lib-shared-toggle-field formControlName=\"users\" label=\"Users\" />\n\n              <span class=\"text-secondary\">*(Allows User Management)</span>\n            </lib-tooltip>\n            <span class=\"checkmark\"></span>\n          </div>\n        </div>\n      </form>\n      @if(saveButton) {\n      <div class=\"flex\">\n        <div class=\"flex-1\"></div>\n        <lib-tooltip [popper]=\"tooltipService.list.savePerms\" class=\"flex-none\">\n          <button\n            (click)=\"savePerms()\"\n            type=\"submit\"\n            class=\"btn w-100 btn-primary\"\n          >\n            @if(updatingPerms){\n            <span\n              class=\"spinner-border spinner-border-sm me-1 p-2\"\n              role=\"status\"\n              aria-hidden=\"true\"\n            ></span>\n            } <span class=\"text-white p-2\">Save</span>\n          </button>\n        </lib-tooltip>\n      </div>\n      }\n    </div>\n  </div>\n</div>\n"],
  "mappings": "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",
  "names": []
}
